!function(){"use strict";function ctd(target){if(target&&target.nodeName)return target;if(!("string"==typeof target||target instanceof String))throw new Error("DOM not found");{let dom=document.getElementById(target);if(dom)return dom}}var l_getDom=function(target){return ctd(target)},l_loading={hide:function(){let elem=document.querySelectorAll("#loading_effect");for(let i=0;i<elem.length;i++)elem[i].parentNode.removeChild(elem[i])},show:function(){let dom=ctd("c_main"),loadingDom=document.createElement("div");loadingDom.setAttribute("class","loading"),loadingDom.id="loading_effect",loadingDom.innerHTML="<div class='spinner'><div class='bounce1'></div><div class='bounce2'></div><div class='bounce3'></div></div>",dom.appendChild(loadingDom)}},ws=new WebSocket("ws://"+location.hostname+":80");function eventConfig(e){e.target.closest("a");let d_button=e.target.closest("button"),d_form=(e.target.closest("div"),e.target.closest("form"));if("submit"==e.type&&d_form&&"form_config"==d_form.id){e.preventDefault();let data={cmd:"save_settings",melody_status:l_getDom("melody_status").value,spray_time:l_getDom("spray_time_ms").value,wifi_ssid:l_getDom("wifi_ssid").value,wifi_pass:l_getDom("wifi_pass").value};console.log("Saving settings..."),ws.send(JSON.stringify(data))}"click"==e.type&&d_button&&"reset_bag"==d_button.id&&(console.log("Resetting bag..."),ws.send(JSON.stringify({cmd:"reset_bag",volume_ml:500})),l_getDom("output").value="Reset Bag")}ws.onmessage=function(evt){l_getDom("output").value=evt.data},window.addEventListener("click",eventConfig),window.addEventListener("submit",eventConfig),window.onload=function(){!function(){let mlSprayed=parseInt(params.ml_sprayed,10),bagLevel=100*Math.round((500-mlSprayed)/500),bagPctMsg=bagLevel+"% remaining";console.log("ml sprayed:"+mlSprayed),l_getDom("bag_pct_msg").innerHTML=bagPctMsg,l_getDom("bag_level").value=bagLevel,l_getDom("wifi_ssid").value=params.ssid,l_getDom("wifi_pass").value=params.pass,l_getDom("wifi_status").innerHTML="1"==params.wifi_status?"Connected to internet":"Not connected to internet",l_getDom("melody_status").value=params.melody,l_getDom("spray_time_ms").value=parseInt(params.spray_time,10)}(),l_loading.hide()}}();